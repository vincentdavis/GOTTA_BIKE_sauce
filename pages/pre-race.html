<!DOCTYPE html>
<html data-settings-key="pre-race-settings-v1">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <link rel="stylesheet" href="/pages/css/common.css"/>
    <link rel="stylesheet" href="./css/pre-race.css"/>
</head>
<body class="transparent-bg">
    <div id="titlebar">
        <header>
            <div class="logo"><img src="/pages/images/icon128.png"/></div>
            <div class="title">PreRace Heatmap</div>
            <div class="filler"></div>
            <div class="buttons">
                <div id="share-btn" class="button" title="Copy image to clipboard"><ms>share</ms></div>
                <a class="button open-settings" href="pre-race-settings.html?width=800&height=700&child-window"
                   title="Open settings window" target="pre-race-settings"><ms>settings</ms></a>
                <div title="Close this window" class="button close electron-only"><ms>close</ms></div>
            </div>
        </header>
    </div>

    <div id="content">
        <div id="event-selector">
            <div class="input-row">
                <select id="cached-events">
                    <option value="">-- Cached Events --</option>
                </select>
            </div>
            <div class="input-row">
                <input type="text" id="event-input" placeholder="Event ID or URL"/>
                <button type="button" id="load-event-btn">Load</button>
            </div>
            <div class="input-row">
                <select id="subgroup-select" disabled>
                    <option value="">-- Select Category --</option>
                </select>
            </div>
        </div>

        <div id="event-info" hidden>
            <div id="event-name" class="event-name"></div>
            <div id="event-start-info" class="event-start-info">
                <span id="event-start-time"></span>
                <span id="event-countdown" class="event-countdown"></span>
            </div>
            <div id="event-route-info" class="event-route-info">
                <span id="route-world" class="route-world"></span>
                <span id="route-name" class="route-name"></span>
                <span class="route-stats">
                    <span id="route-distance"></span>
                    <span id="route-elevation"></span>
                </span>
                <span id="route-profile" class="route-profile"></span>
                <span id="route-difficulty" class="route-difficulty"></span>
                <a id="route-info-link" class="route-info-link" href="#" hidden>Route Info</a>
            </div>
            <div id="event-details">
                <span id="entrant-count">0</span> entrants
            </div>
            <div class="action-row">
                <button type="button" id="import-btn" disabled>Import Data</button>
                <span id="import-status"></span>
            </div>
        </div>

        <div id="loading" hidden>
            <div class="spinner"></div>
            <span>Loading...</span>
        </div>

        <div id="error" class="error" hidden></div>

        <div id="heatmap-container">
            <div id="heatmap-chart"></div>
        </div>

        <div id="radar-chart-container" hidden>
            <div class="radar-chart-divider"><span>Team Radar Comparison</span></div>
            <div class="radar-charts-wrapper">
                <div class="radar-chart-box">
                    <canvas id="radar-chart-power-wkg"></canvas>
                </div>
                <div class="radar-chart-box">
                    <canvas id="radar-chart-power-watts"></canvas>
                </div>
                <div class="radar-chart-box">
                    <canvas id="radar-chart-phenotype"></canvas>
                </div>
            </div>
        </div>

        <div id="no-data" class="no-data" hidden>
            <p>No power data available.</p>
            <p>Click "Import Data" to fetch athlete power profiles from GOTTA.BIKE.</p>
        </div>

        <!-- Heatmap tooltip (positioned on hover) -->
        <div id="heatmap-tooltip" class="heatmap-tooltip" hidden>
            <div class="tooltip-rider"></div>
            <div class="tooltip-metric"></div>
            <div class="tooltip-stats"></div>
        </div>

        <!-- Rider details modal -->
        <div id="rider-modal" class="rider-modal-overlay" hidden>
            <div class="rider-modal">
                <div class="rider-modal-header">
                    <span class="rider-modal-title"></span>
                    <button class="rider-modal-close" title="Close">&times;</button>
                </div>
                <div class="rider-modal-body"></div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script type="module">
        import {preRaceMain} from './src/pre-race.mjs';
        preRaceMain();
    </script>
</body>
</html>
